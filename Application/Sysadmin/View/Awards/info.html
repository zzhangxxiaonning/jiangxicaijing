<include file="Common/title" />
<link href="{$public}css/jquery.stepy.css{$versionnumber}" rel="stylesheet">

  <!--pickers css-->
  <link rel="stylesheet" type="text/css" href="{$public}js/bootstrap-datetimepicker/css/datetimepicker-custom.css{$versionnumber}" />
</head>

<body class="sticky-header">

<section>
    <!-- left side start-->
    <include file="Common/left" />
    
    <!-- main content start-->
    <div class="main-content" >

        <!-- header section start-->
        <include file="Common/header" />

        <!-- page heading start-->
        <div class="page-heading">
            <h3>
                {$cat_name}
            </h3>
            <ul class="breadcrumb">
                <li>
					<a href="{:U('Index/index')}">控制面板</a>
				</li>
				<li>
					<a href="{:U('Awards/index')}">获奖荣誉管理</a>
				</li>
				<li class="active">{$cat_name}</li>
            </ul>
        </div>
        <!-- page heading end-->

        <!--body wrapper start-->
        <div class="wrapper">
<div class="row">
<div class="col-md-12">
	<section class="panel">
<header class="panel-heading custom-tab">
<ul class="nav nav-tabs">
	<li class="active"><a href="#tab_1" data-toggle="tab">基础</a></li>
</ul>
</header>
<div class="panel-body">
<form action="" id="data_form_id" onsubmit="submit_form();return false;" class="form-horizontal ">
<div class="tab-content">
	<div class="tab-pane active" id="tab_1">
		<section class="panel">
			<div class="panel-body form-horizontal ">

				<div class="form-group">
					<label class="control-label col-md-3">标题</label>
					<div class="col-md-7 col-xs-11">
							<input class="form-control form-control-inline input-medium" size="16" type="text" name="title" id="title" value="{$info.title}"/>
							<span class="help-block">标题不可为空</span>
					</div>
				</div>
				
				<div class="form-group">
					<label class="control-label col-md-3">获奖类型一级分类</label>
					<div class="col-md-7 col-xs-11">
							<select name="cat_id_two" class="form-control form-control-inline input-medium cat_lists_two">
							<option value="0" >请选择一级分类</option>
								<volist name="cat_lists" id="vo">
								<option value="{$vo.id}" <if condition="$info['cat_cat_id'] eq $vo['id']"> selected</if>>{$vo.catname}</option>
								</volist>
							</select>
						<span class="help-block">一级分类不可为空</span>
					</div>
				</div>

				<div class="form-group">
					<label class="control-label col-md-3">获奖类型二级分类</label>
					<div class="col-md-7 col-xs-11">
						<select name="cat_id" id="cat_id" class="form-control form-control-inline input-medium cat_lists">
							<option value="0" >请选择二级分类</option>
							<volist name="cat_list" id="vo">
								<option value="{$vo.id}" <if condition="$info['cat_id'] eq $vo['id']"> selected</if>>{$vo.catname}</option>
							</volist>
						</select>
						<span class="help-block">二级分类不可为空</span>
					</div>
				</div>
				<div class="form-group">
					<label class="control-label col-md-3">获奖级别</label>
					<div class="col-md-7 col-xs-11">
						<select name="rank_id" id="rank_id" class="form-control form-control-inline input-medium">
							<option value="0" >请选择级别</option>

							<volist name="rank_list" id="co">
								<option value="{$co.id}" <if condition="$info['rank_id'] eq $co['id']"> selected</if>>{$co.catname}</option>
							</volist>

						</select>
					</div>
				</div>
				<div class="form-group">
					<label class="control-label col-md-3">获奖年度</label>
					<div class="col-md-7 col-xs-11">
						<select name="year_id" id="year_id" class="form-control form-control-inline input-medium">
							<option value="0" >请选择年度</option>

							<volist name="year_list" id="co">
								<option value="{$co.id}" <if condition="$info['year_id'] eq $co['id']"> selected</if>>{$co.catname}</option>
							</volist>

						</select>
					</div>
				</div>
				<div class="form-group">
					<label class="control-label col-md-3">主持人</label>
					<div class="col-md-7 col-xs-11">
						<input class="form-control form-control-inline input-medium" size="16" type="text"  value="{$info.mid_name}" disabled/>
					</div>
				</div>
				<div class="form-group">
					<label class="control-label col-md-3">参与人</label>
					<div class="yutongxin_box">
						<volist name="arrs" id="ar">
						<span id="{$ar.id}"><input type="checkbox" value="{$ar.id}" name="partic_id[]" style="margin-left:10px;" checked="checked"><em>{$ar.username}</em></span>
						</volist>
					</div>
					<!--<div class="col-md-7 col-xs-11">-->
						<!--<input class="form-control form-control-inline input-medium" size="16" type="text" name="title" value="{$info.title}"/>-->
					<!--</div>-->
					<label class="control-label col-md-3"></label>
					<div class="col-md-7 col-xs-11">
						<input class="form-control form-control-inline input-medium" size="16" type="text" id="mem_id_on" placeholder="请输入要添加的参与人的姓名/手机号"/>
						<span id="mem_con"><div><input type="hidden" value="{$info.partic_id}" style="width:20px;">{$info.username}</div></span>
					</div>
				</div>
				<div class="form-group">
					<label class="control-label col-md-3">指导老师</label>
					<div class="col-md-7 col-xs-11">
						<select name="teacher_id" class="form-control form-control-inline input-medium">
							<option value="0">请选择导师</option>

							<volist name="teacher_list" id="co">
								<option value="{$co.id}" <if condition="$info['teacher_id'] eq $co['id']"> selected</if>>{$co.username}</option>
							</volist>

						</select>
					</div>
				</div>
				<div class="form-group">
					<label class="control-label col-md-3">导师手机号</label>
					<div class="col-md-7 col-xs-11">
						<input class="form-control form-control-inline input-medium" size="16" type="text" name="tea_phone" value="{$info.tea_phone}"/>
					</div>
				</div>

				<div class="form-group">
					<label class="control-label col-md-3">荣誉证书</label>
					<div class="col-md-7 col-xs-11">
						<div class="input-group m-bot15">

							<input type="text" class="form-control" name="thumb" id="thumb_input" value="{$info.thumb}">
							<span class="input-group-btn">
								<button class="btn btn-default enet360_upload_images" var_id="thumb" type="button">上传</button>
							</span>
						</div>
						<span class="help-block">宽高157px*218px（比例1:1.4）</span>
						<div class="fileupload fileupload-new">
							<div class="fileupload-new thumbnail" style="max-width: 100%; height: auto;">
								<img id="thumb_img" src="{$info.thumb|default='/Uploads/noimg.png'|Thumb}" alt="" style="min-width:157px;height:218px;"/>
							</div>
						</div>
					</div>
				</div>

				<div class="form-group">
					<label class="control-label col-md-3">相关照片</label>
					<div class="col-md-7 col-xs-11">
						<div class="input-group m-bot15">
							<input type="button" id="J_selectImage" value="批量上传" /><最多三张>
						</div>
						<div id="J_imageView">
							<notempty name="img">
								<volist name="img" id="v">
								<span><img src="{$v}" class="img_upload" style="width:auto;max-height:100px;"/><input type="hidden" name="img[]" value="{$v}" /></span>
								</volist>
							</notempty>
						</div>

					<style>
						.img_upload{
							diaplay:block;
							border:1px solid #d5d5d5;
							width: 150px;
							height: 150px;
							margin-left: 10px;
							cursor:pointer;
						}
					</style>
					</div>
				</div>


				<div class="form-group">
					<label class="control-label col-md-3">备注</label>
					<div class="col-md-7 col-xs-11">
						<textarea name="info" id="info" width="100%" style="width:100%;min-height:100px;">{$info.info}</textarea>
					</div>
				</div>
				<div class="form-group">
					<label class="control-label col-md-3">公开状态</label>
					<div class="col-md-4 col-xs-11">

						<div class="radio col-md-6">
							<label>
								<input name="isshow" value="1" type="radio" <if condition="($info['isshow'] eq 1) OR ($info['isshow'] eq 0)"> checked</if> >
								公开
							</label>
						</div>

						<div class="radio col-md-6">
							<label>
								<input name="isshow" value="0" type="radio"  <eq name="info.isshow" value="0"> checked</eq> >
								不公开
							</label>
						</div>
						<span class="help-block">默认向全校公开</span>
					</div>

				</div>

				<div class="form-group">
					<label class="control-label col-md-3">审核状态</label>
					<div class="col-md-4 col-xs-11">

						<div class="radio col-md-4">
							<label>

								<input name="examine" value="1" type="radio" <if condition="($info['examine'] eq 1) OR ($info['examine'] eq 0)"> checked</if> >
								待审核
							</label>
						</div>

						<div class="radio col-md-4">
							<label>
								<input name="examine" value="2" type="radio"  <eq name="info.examine" value="2"> checked</eq> >
								审核通过
							</label>
						</div>

						<div class="radio col-md-4">
							<label>
								<input name="examine" value="3" type="radio"  <eq name="info.examine" value="3"> checked</eq> >
								审核不通过
							</label>
						</div>

						<span class="help-block"></span>
					</div>
				</div>

				<div class="form-group">
					<label class="control-label col-md-3">显示状态</label>
					<div class="col-md-4 col-xs-11">

							<div class="radio col-md-6">
								<label>
									<input name="status" value="1" type="radio" <eq name="info.status" value="1"> checked</eq> >
									已启用
								</label>
							</div>

							<div class="radio col-md-6">
								<label>
									<input name="status" value="0" type="radio"  <eq name="info.status" value="0"> checked</eq> >
									已禁用
								</label>
							</div>

						<span class="help-block"></span>
					</div>
				</div>
				
				<div class="form-group">
					<div class="col-lg-offset-2 col-lg-10">
						<input name="id" type="hidden" value="{$info.id}">
						<button class="btn btn-primary" type="submit">保存并关闭</button>
						<button class="btn btn-default" type="button" onclick="location.href='{:U('rec_index')}'">取消</button>
					</div>
				</div>

			</div>
		</section>
	</div>
	<div class="tab-pane" id="tab_2">
		<section class="panel">
			<div class="panel-body form-horizontal " style="border: 1px solid #d5d5d5;">

				<div class="form-group">
					<div class="col-md-12 col-xs-11" id="cimg">

						<textarea name="content" id="editor_id" width="100%" style="width: 100%;height:400px;" class=" enet360_content_simple">{$info.content}</textarea>
						<span class="help-block"></span>
					</div>
				</div>
				<div class="form-group">
					<div class="col-lg-offset-2 col-lg-10" style="text-align:center;padding-right:20%;">
						<input name="id" type="hidden" value="{$info.id}">
						<button class="btn btn-primary" type="submit">保存并关闭</button>
						<button class="btn btn-default" type="button" onclick="location.href='{:U('index')}'">取消</button>
					</div>
				</div>
			</div>
		</section>
	</div>
</div>
</form>
</div>
	</section>
</div>
</div>
        </div>
        <!--body wrapper end-->
        <include file="Common/footer" />
    </div>
    <!-- main content end-->
</section>

<!-- Placed js at the end of the document so the pages load faster -->
<script src="{$public}js/jquery-1.10.2.min.js{$versionnumber}"></script>
<script src="{$public}js/jquery-ui-1.9.2.custom.min.js{$versionnumber}"></script>
<script src="{$public}js/jquery-migrate-1.2.1.min.js{$versionnumber}"></script>
<script src="{$public}js/jquery.validate.min.js{$versionnumber}"></script>
<script src="{$public}js/jquery.stepy.js{$versionnumber}"></script>
<script src="{$public}js/bootstrap.min.js{$versionnumber}"></script>
<script src="{$public}js/modernizr.min.js{$versionnumber}"></script>
<script src="{$public}js/jquery.nicescroll.js{$versionnumber}"></script>

<!--pickers plugins-->
<script type="text/javascript" src="{$public}js/bootstrap-datetimepicker/js/bootstrap-datetimepicker.js{$versionnumber}"></script>


<!--pickers initialization-->
<script src="{$public}js/pickers-init.js{$versionnumber}"></script>

<!--common scripts for all pages-->
<script src="{$public}js/scripts.js{$versionnumber}"></script>
<include file="Common/footer_bottom" />
<script>
function submit_form(){
	var title = $('#title').val();
	var cat_id = $('#cat_id').val();
	var cat_id = $('#cat_id').val();
	var rank_id = $('#rank_id').val();
	var year_id = $('#year_id').val();
	var image = $('#image').val();
	if(title == ''){
		layer.msg('请输入标题',{time:1500},function(){$('#title').focus()});
		return false;
	}
	if(cat_id == 0){
		layer.msg('请选择获奖类型二级分类',{time:1500},function(){$('#cat_id').focus()});
		return false;
	}

	if(rank_id == 0){
		layer.msg('请选择获奖级别',{time:1500},function(){$('#rank_id').focus()});
		return false;
	}
	if(year_id == 0){
		layer.msg('请选择获奖年度',{time:1500},function(){$('#year_id').focus()});
		return false;
	}
	if(image == ''){
		layer.msg('请上传荣誉证书',{time:1500},function(){$('#image').focus()});
		return false;
	}
	layer.load(0, {shade: [0.2,'#616161']});
	$("#data_form_id").ajaxSubmit({
		type: "post",
		beforeSubmit:function(data){
			$.each(data,function(i){
				if(data[i]['name'] == 'username' && data[i]['value'] == '' ){
					layer.closeAll('loading');
					$("input[name='"+data[i]['name']+"']").focus();
					return false;
				}
			});
			
		},
		success:function(data){
			layer.closeAll('loading');
			if(data.status == 1){
				layer.msg(data.info,{shift:1,time:1500},function(){
					window.location.href = data.url;
				});
			}else{
				layer.msg(data.info,{shift:6,time:3000});
			}
		},
		dataType:	"json"
	});
}

$(document).on('change','.cat_lists_two',function(){
	var val = $(this).val();
	$.ajax({
		type: 'post',
		url: "{:U('cat_lists')}",
		data: {
			'val':val,
		},
		dataType:'json',
		success: function(data) {
//			console.log(data);
			var html = '<option value="0" >请选择二级分类</option>';
			if(data.status == 1){
				$.each(data.date,function(m,n){
					html += '<option value="'+n.id+'">'+n.catname+'</option>';
				});

				$('.cat_lists').html(html);
			}else{
				layer.msg('请先添加此分类下的二级分类',{time:1500},function(){
					$('.cat_lists').html(html);
				});

				return false;
			}
		}
	});

});

$(document).on('click','.cat_lists',function(){

	var val = $('.cat_lists_two').val();

	if(val == 0){
		alert('请先选择一级分类');
//		layer.msg('请先选择一级分类',{time:1500},function(){});
//		layer.open({
//			type: 1,
//			skin: 'layui-layer-demo', //样式类名
//			closeBtn: 0, //不显示关闭按钮
//			anim: 2,
//			shadeClose: true, //开启遮罩关闭
//			content: '请先选择一级分类'
//		});
	}else{
		return true;
	}

});

</script>
<style type="text/css">
	.yutongxin_box{
		margin: 10px 0;
	}
	.yutongxin_box input{
		margin: 0 0 0 10px;
	}
	.yutongxin_box em{font-style: normal}
	#mem_con em{font-style: normal}
</style>
<script type="text/javascript">


	$("#mem_id_on").on("keyup",function(){
		var value = $('#mem_id_on').val();
		var val_arr = [];
		var i=0;
		$(".yutongxin_box span input").each(function(i){
			var val__ = $(this).val();
			val_arr[i] = val__;
			i++;

		});
		console.log(val_arr);
		if(value != ''){
			$.ajax({
				type: 'post',
				url: "{:U('mems')}",
				data: {
					'value' : value,
				},
				dataType:'json',
				success: function(data) {
					console.log(data);
					var con_html = '';
					if(data.msg){
						$.each(data.dat,function(m,n){
							con_html += '<span id='+n.id+'><input type="checkbox" value="'+n.id+'" name="partic_id[]" style="margin-left:10px;"';
							if(val_arr[0]){
								console.log(val_arr)
								if($.inArray(n.id,val_arr) != -1){
									con_html += 'checked';
								}
							}
							con_html += '>'+'<em>'+n.username+'</em>'+'</span>';
						});
					}
					$("#mem_con").html(con_html);
				}
			});
		}
	});

	$("#mem_con").on('change','input',function(){
		//var val_ = $(this).val();
		var id_ = $(this).parent('span').attr("id");
		var html_ = $(this).parent('span').prop("outerHTML");
		if ($(this).is(":checked")) {
			//var val_ = $(this).val();
			$(".yutongxin_box").prepend(html_);
			$(".yutongxin_box").find('input').attr("checked","checked");
		}else{
			//var val_ = $(this).val();
			$(".yutongxin_box").find('input').parent('span#'+id_).remove();
		}
	})
	$('.yutongxin_box').on('change','input',function(){
		var val_ = $(this).val();
		var id_ = $(this).parent('span').attr("id");
		if ($(this).is(":checked")) {
			// $("#mem_con").find('span#'+id_).find('input').attr("checked","checked");
		}else{
			$("#mem_con").find('span#'+id_).find('input').removeAttr("checked");
			$(this).parent('span#'+id_).remove();
		}
	})
</script>

</body>
<!--/**编辑器 kindeditor **/-->
<script type="text/javascript">
	var Kind_upload_json = "{:U('Kind/upload_json')}";
	var Kind_file_manager_json = "{:U('Kind/file_manager_json')}";
	//var Kind_DiyImgName = 'activity';
</script>
<link href="{$source}kindeditor/themes/default/default.css{$versionnumber}" rel="stylesheet" type="text/css"/>
<script src="{$source}kindeditor/kindeditor-min.js{$versionnumber}" type="text/javascript"></script>
<script src="{$source}kindeditor/lang/zh_CN.js{$versionnumber}" type="text/javascript"></script>
<script src="{$source}kindeditor/config.js{$versionnumber}" type="text/javascript"></script>

</html>
